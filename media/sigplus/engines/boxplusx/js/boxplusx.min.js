(function(){/*
boxplusx: a versatile lightweight pop-up window engine
@author  Levente Hunyadi
@version 1.0
@remarks Copyright (C) 2009-2017 Levente Hunyadi
@remarks Licensed under GNU/GPLv3, see http://www.gnu.org/licenses/gpl-3.0.html
@see     http://hunyadi.info.hu/projects/boxplusx
*/
'use strict';var da="function"==typeof Object.defineProperties?Object.defineProperty:function(d,q,m){d!=Array.prototype&&d!=Object.prototype&&(d[q]=m.value)},ea="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function fa(d){if(d){for(var q=ea,m=["Object","assign"],n=0;n<m.length-1;n++){var t=m[n];t in q||(q[t]={});q=q[t]}m=m[m.length-1];n=q[m];d=d(n);d!=n&&null!=d&&da(q,m,{configurable:!0,writable:!0,value:d})}}
var ha="function"==typeof Object.assign?Object.assign:function(d,q){for(var m=1;m<arguments.length;m++){var n=arguments[m];if(n)for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(d[t]=n[t])}return d};fa(function(d){return d||ha});var ia={id:null,slideshow:0,autostart:!1,loop:!1,preferredWidth:800,preferredHeight:600,useDevicePixelRatio:!0,navigation:"bottom",controls:"below",captions:"below",contextmenu:!0,metadata:!1,dir:"ltr"};
function ja(d,q){function m(){n=!1}var n=!1,t=0,y=0,H=["auto","scroll"];d.addEventListener("mousedown",function(d){var k=window.getComputedStyle(q);if(0<=H.indexOf(k.overflowX)||0<=H.indexOf(k.overflowY))t=d.clientX,y=d.clientY,n=!0,d.preventDefault()});d.addEventListener("mouseup",m);d.addEventListener("mouseout",m);d.addEventListener("mousemove",function(d){n&&(q.scrollLeft-=d.clientX-t,q.scrollTop-=d.clientY-y,t=d.clientX,y=d.clientY)})}
(function(){function d(a){this.S(a)}function q(){}function m(a){var b={};1<a.length&&a.substr(1).split("&").forEach(function(a){var c=a.indexOf("="),f=0<=c?a.substr(c+1):"";b[decodeURIComponent(0<=c?a.substr(0,c):a)]=decodeURIComponent(f)});return b}function n(a){var b=document.createElement("a");b.href=a;a=b.hash.indexOf("!");return{protocol:b.protocol,host:b.host,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,V:m(b.search),hash:b.hash,id:b.hash.substr(1,(0<=a?a:b.hash.length)-
1),U:m(b.hash.substr(Math.max(0,a)))}}function t(a){a=n(a);var b=n(location.href);return a.protocol===b.protocol&&a.host===b.host&&a.pathname===b.pathname&&a.search===b.search}function y(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")}function H(a,b){a=a||{};for(var c in JSON.parse(JSON.stringify(b)))Object.prototype.hasOwnProperty.call(a,c)||(a[c]=b[c]);return a}function I(a,b){return a.hasAttribute(b)?a.getAttribute(b):null}function k(a,
b){b?a.classList.remove("boxplusx-hidden"):a.classList.add("boxplusx-hidden")}function C(a){return!a.classList.contains("boxplusx-hidden")}function r(a,b,c){var h=document.createElement("div");h.classList.add("boxplusx-"+a);b&&h.classList.add("boxplusx-hidden");c&&c.forEach(function(a){h.appendChild(a)});return h}function L(a){return a.map(function(a){return r(a)})}function ka(a,b){if(/\.jpe?g$/i.test(a)){var c=new XMLHttpRequest;c.open("get",a);c.responseType="blob";c.onload=function(){la(c.response,
b)};c.onerror=function(){b(-1)};c.send()}else b(-2)}function la(a,b){var c=new FileReader;c.onload=function(){var a=new DataView(c.result);if(65496!=a.getUint16(0))b(-2);else{for(var f=a.byteLength,e=2;e<f;){var l=a.getUint16(e);e+=2;if(65505==l){if(1165519206!=a.getUint32(e+=2)){b(-1);return}l=18761==a.getUint16(e+=6);e+=a.getUint32(e+4,l);var d=a.getUint16(e,l);e+=2;for(var p=0;p<d;p++)if(274==a.getUint16(e+12*p,l))return b(a.getUint16(e+12*p+8,l))}else if(65280!=(l&65280))break;else e+=a.getUint16(e)}return b(-1)}};
c.readAsArrayBuffer(a)}function ma(a){return[].slice.call(a).map(function(a){a:{if(null!==a&&"a"===a.tagName.toLowerCase()){var b=I(a,"data-title");if(null!==b)break a;if(b=a.querySelector("img"))if(b=I(b,"alt"),null!==b)break a}b=""}a:{if(null!==a&&"a"===a.tagName.toLowerCase()){var h=I(a,"data-summary");if(null!==h)break a;h=I(a,"title");if(null!==h)break a}h=""}b===h&&(h="");var f="";null!==a&&"a"===a.tagName.toLowerCase()&&(f=a.href);var e=a.dataset&&a.dataset.download||"",l;a=a.getElementsByTagName("img");
0<a.length&&(l=a[0]);return{url:f,image:l,title:b,description:h,download:e}})}function u(a,b){a=this.f.querySelectorAll(".boxplusx-"+a);for(var c=0;c<a.length;++c)b(a[c])}function M(a,b){var c=this;Object.keys(b).forEach(function(h){u.call(c,h,function(f){f.addEventListener(a,b[h].bind(c),!1)})})}function S(a){switch(a){case 0:case 1:return!1}return!0}function v(a){function b(a){switch(a){case 0:return"unavailable";case 1:return"image";case 2:return"video";case 3:return"embed";case 4:return"document";
case 5:return"frame";default:return"none"}}var c=this.s.classList;c.remove("boxplusx-"+b(this.C));c.remove("boxplusx-interactive");this.C=a;c.add("boxplusx-"+b(a));S(a)&&c.add("boxplusx-interactive")}function N(){var a=this,b=w.call(this),c=0==b,h=this.i,f=b>=h.length-1,e=this.a.loop&&!(c&&f),l=0<this.a.slideshow;u.call(this,"previous",function(a){k(a,e||!c)});u.call(this,"next",function(a){k(a,e||!f)});u.call(this,"start",function(b){k(b,l&&!a.l&&!f)});u.call(this,"stop",function(b){k(b,l&&a.l)});
u.call(this,"download",function(a){k(a,!!h[b].download)});u.call(this,"metadata",function(b){var c;if(c=a.a.metadata)c=!!a.f.querySelector(".boxplusx-detail");k(b,c)})}function T(){k(this.D,(this.c>this.v.clientWidth||this.g>this.v.clientHeight)&&!S(this.C));var a=this.D.classList;this.m?a.remove("boxplusx-collapse"):a.add("boxplusx-collapse");a=this.D.classList;this.m?a.add("boxplusx-expand"):a.remove("boxplusx-expand")}function U(){O.call(this);V.call(this);v.call(this,-1);for(var a=this.b;a.hasChildNodes();)a.removeChild(a.lastChild);
k(this.A,!1);k(this.h,!1)}function w(){return this.j[this.j.length-1]}function x(a,b,c){function h(){C(d.h)&&(p.setProperty("max-width",l),O.call(d),k(d.G,!1),w.call(d)>=d.i.length-1&&(d.l=!1),N.call(d),k(d.A,!0),W.call(d),T.call(d),d.l&&X.call(d))}this.w=a;var f=window.getComputedStyle(this.f);b=b||f.getPropertyValue("width");c=c||f.getPropertyValue("height");O.call(this);k(this.A,!0);var e=this.v.classList;e.remove("boxplusx-fixedaspect");e.remove("boxplusx-draggable");1===a||2===a?(a=this.J.style,
a.setProperty("width",this.c+"px"),a.setProperty("padding-top",100*this.g/this.c+"%"),e.add("boxplusx-fixedaspect")):4===a?e.add("boxplusx-draggable"):3===a&&(a=this.s.style,a.setProperty("width",this.c+"px"),a.setProperty("max-height",this.g+"px"));Y.call(this);a=f.getPropertyValue("width");e=f.getPropertyValue("height");var l=f.getPropertyValue("max-width"),d=this,p=this.f.style;b!=a||c!=e?(k(this.A,!1),p.removeProperty("max-width"),p.setProperty("width",b),p.setProperty("height",c),this.f.classList.add("boxplusx-animation"),
f=Math.max.apply(null,f.getPropertyValue("transition-duration").split(",").map(function(a){var b=parseFloat(a);return/\ds$/.test(a)?1E3*b:b})),window.setTimeout(h,f)):h();p.setProperty("width",a);p.setProperty("height",e)}function O(){this.f.classList.remove("boxplusx-animation");var a=this.f.style;a.removeProperty("width");a.removeProperty("height")}function Z(a,b,c){function d(a){c(a);return f.f.offsetHeight}var f=this,e=this.h.clientHeight,l=d(b);if(l<=e)return b;l=d(a);if(l>=e)return c(b),b;for(var k=
1;10>k;++k){l=(a+b)/2|0;var p=d(l);p<e?(a=l,l=p):(b=l,l=p)}c(a);return a}function Y(){if(2===this.w){var a=this.f.style;Z.call(this,0,1E3,function(b){a.setProperty("max-width",b/10+"%")})}else if(4===this.w||3===this.w){var b=this.s.style;b.removeProperty("max-height");var c=Z.call(this,0,window.innerHeight,function(a){b.setProperty("height",a+"px")});b.removeProperty("height");b.setProperty("max-height",Math.min(c,this.g)+"px")}}function na(a,b){var c=a.src;if(/^file:/.test(c))b(-3);else{var d=window.EXIF;
this.a.metadata&&d?d.getData(a,function(){var c=0,d=Object.assign({},a.iptcdata,a.exifdata);if(0<Object.keys(d).length){var l=d;(d=d.Orientation)&&(c=+d)}b(c,l)}):ka(c,function(a){b(a)})}}function P(a){var b=this,c=this.i[a];this.j.push(a);var d=window.getComputedStyle(this.f),f=d.getPropertyValue("width"),e=d.getPropertyValue("height");J.call(this);k(this.G,!0);var l=c.title,q=c.description;c=c.url;d=n(c);var p=d.pathname,m=Object.assign({},d.V,d.U);this.c=parseInt(m.width,10)||this.a.preferredWidth;
this.g=parseInt(m.height,10)||this.a.preferredHeight;if(t(c))(a=document.getElementById(d.id?d.id:m.target))?(a=a.cloneNode(!0),E.call(this,a,l,q),v.call(this,4),x.call(this,3,f,e)):Q.call(this);else if(/\.(gif|jpe?g|png|svg)$/i.test(p)){var A=document.createElement("img");A.addEventListener("load",function(){na.call(b,A,function(a,c){var d=document.createDocumentFragment(),g=document.createElement("div"),h=document.createElement("div");0<a&&h.classList.add("boxplusx-orientation-"+a);var p=h.style;
p.setProperty("background-image",'url("'+A.src+'")');var k=b.a.useDevicePixelRatio?window.devicePixelRatio||1:1,z=Math.floor(A.naturalHeight/k);k=Math.floor(A.naturalWidth/k);5<=a&&8>=a?(b.c=z,b.g=k,p.setProperty("width",100*k/z+"%"),p.setProperty("height",100*z/k+"%")):(b.c=k,b.g=z,p.removeProperty("width"),p.removeProperty("height"));b.m||(a=g.style,a.setProperty("width",b.c+"px"),a.setProperty("height",b.g+"px"));g.appendChild(h);d.appendChild(g);if(c){g=r("detail",!0);h=document.createElement("table");
a=Object.keys(c);p=a.length;a.sort();for(z=0;z<p;++z){k=a[z];var R=document.createElement("tr"),m=document.createElement("td");m.innerText=k;var n=document.createElement("td");n.innerText=c[k];R.appendChild(m);R.appendChild(n);h.appendChild(R)}g.appendChild(h);d.appendChild(g)}E.call(b,d,l,q);b.H.style.setProperty("max-width",b.c+"px");v.call(b,1);x.call(b,b.m?2:4,f,e)})},!1);A.addEventListener("error",Q.bind(this),!1);A.src=c;a<b.i.length-1&&(a=b.i[a+1].url,c=n(a),/\.(gif|jpe?g|png|svg)$/i.test(c.pathname)&&
(document.createElement("img").src=a))}else if(/\.(mov|mpe?g|mp4|ogg|webm)$/i.test(p)){var B=document.createElement("video");B.controls=!0;B.addEventListener("loadedmetadata",function(){E.call(b,B,l,q);v.call(b,2);b.c=B.videoWidth;b.g=B.videoHeight;x.call(b,2,f,e)},!1);B.addEventListener("error",Q.bind(this),!1);B.src=c}else/\.pdf$/.test(p)?(a=document.createElement("embed"),a.src=c,a.type="application/pdf",E.call(b,a,l,q),v.call(b,3),x.call(b,2,f,e)):(a=/^https?:\/\/(?:www\.)youtu(?:\.be|be\.com)\/(?:embed\/|watch\?v=|v\/|)([-_0-9A-Z]{11,})/i.exec(c),
null!==a?aa.call(this,"https://www.youtube.com/embed/"+a[1]+"?"+y({rel:"0",controls:"1",W:"0"}),l,q):aa.call(this,c,l,q))}function V(){for(var a=this.s;a.hasChildNodes();)a.removeChild(a.lastChild);a=this.f.style;var b=this.J.style,c=this.s.style;b.removeProperty("padding-top");b.removeProperty("width");c.removeProperty("width");a.removeProperty("max-width");c.removeProperty("max-height")}function E(a,b,c){V.call(this);this.s.appendChild(a);this.H.style.removeProperty("max-width");this.R.innerHTML=
b;this.P.innerHTML=c}function Q(){v.call(this,0);x.call(this,2)}function aa(a,b,c){var d=this,f=document.createElement("iframe");f.width=""+this.c;f.height=""+this.g;f.src=a;E.call(this,f,b,c);var e=!1;f.addEventListener("load",function(){e||(e=!0,v.call(d,5),x.call(d,1))},!1)}function X(){J.call(this);this.B=window.setTimeout(this.next.bind(this),this.a.slideshow)}function J(){this.B&&(window.clearTimeout(this.B),this.B=null)}function F(a){switch(this.a.dir){case "rtl":return a.offsetParent.offsetWidth-
a.offsetWidth-a.offsetLeft;default:return a.offsetLeft}}function K(a,b){var c=this.b.style;c.setProperty("rtl"==this.a.dir?"right":"left",-a+"px");c.setProperty("transition-duration",0<b?5*b+"ms":"")}function W(){if(C(this.u)){for(var a=0;a<this.b.childNodes.length;++a)this.b.childNodes[a].classList.remove("boxplusx-current");var b=Math.max(this.b.offsetWidth-this.u.offsetWidth,0),c=this.b.childNodes[w.call(this)];c.classList.add("boxplusx-current");a=-F.call(this,this.b);var d=F.call(this,c);b=Math.min(b,
d);a>b&&(a=b);c=Math.max(0,d-this.u.offsetWidth+c.offsetWidth);a<c&&(a=c);K.call(this,a,0)}}function ba(){var a=Math.max(this.b.offsetWidth-this.u.offsetWidth,0);K.call(this,0,a-(a- -F.call(this,this.b)))}function ca(){var a=Math.max(this.b.offsetWidth-this.u.offsetWidth,0);K.call(this,a,a- -F.call(this,this.b))}function G(){K.call(this,-F.call(this,this.b),0)}window.BoxPlusXDialog=d;q.prototype.L="boxplusx";d.prototype.bind=function(a){function b(a){c.M(d,a)}var c=this;a=[].slice.call(a);var d=ma(a);
a.forEach(function(a,c){a.addEventListener("click",function(a){a.preventDefault();b(c)},!1)});return b};d.prototype.S=function(a){function b(){if(g.c>g.v.clientWidth||g.g>g.v.clientHeight)g.m=!g.m,P.call(g,w.call(g))}this.a=H(a,ia);a=r("aspect");var c=r("content"),d=r("expander"),f=r("navbar"),e=r("navigation",!1,[f].concat(L(["rewind","forward"]))),l=r("viewport",!1,[a,c,d].concat(L(["previous","next"]))),k=r("controls",!1,L("previous next close start stop download metadata".split(" "))),p=r("title"),
q=r("description"),m=r("caption",!1,[p,q]),n=r("wrapper",!1,[l,e]);n=r("wrapper",!1,[n,k]);n=r("wrapper",!0,[n,m]);var t=r("progress",!0),u=r("dialog",!1,[n,t]),v=r("container",!0,[u]);this.a.id&&(v.id=this.a.id);m.classList.add("boxplusx-"+this.a.captions);k.classList.add("boxplusx-"+this.a.controls);e.classList.add("boxplusx-"+this.a.navigation);document.body.appendChild(v);this.h=v;this.f=u;this.A=n;this.v=l;this.H=m;this.R=p;this.P=q;this.J=a;this.s=c;this.D=d;this.u=e;this.b=f;this.G=t;this.i=
[];this.j=[];this.B=null;this.l=!1;this.w=2;this.c=this.a.c;this.g=this.a.g;this.C=-1;this.m=!0;var g=this;this.h.addEventListener("click",function(a){a.target===g.h&&g.close.call(g)},!1);M.call(this,"click",{previous:this.F,next:this.next,close:this.close,start:this.start,stop:this.O,metadata:this.T,download:this.download,rewind:G,forward:G});M.call(this,"mouseover",{rewind:ba,forward:ca});M.call(this,"mouseout",{rewind:G,forward:G});this.a.contextmenu||u.addEventListener("contextmenu",function(a){a.preventDefault()});
var x=this.a.dir;this.h.dir=x;new ja(l,c);d.addEventListener("click",b);l.addEventListener("dblclick",b);c.addEventListener("mousewheel",function(a){var b="hidden"!=window.getComputedStyle(c).overflowY,d=c.scrollHeight-c.clientHeight;if(b&&0<d){b=c.scrollTop;var e=a.deltaY;(b===d&&0<e||0===b&&0>e)&&a.preventDefault()}});window.addEventListener("keydown",function(a){var b;if(b=C(g.h)){b=a.target;var c=["input","select","textarea"];b=!(null!==b&&0<=c.indexOf(b.tagName.toLowerCase()))}if(b){b=[27,36,
35];switch(x){case "ltr":b.push(37,39);break;case "rtl":b.push(39,37)}b=b.indexOf(a.which||a.keyCode);0<=b&&([g.close,g.I,g.K,g.F,g.next][b].call(g),a.preventDefault())}},!1);var D,y=0;l.addEventListener("touchstart",function(a){D=a.changedTouches[0].pageX});l.addEventListener("touchend",function(a){var b=(new Date).getTime(),c=b-y;0<c&&500>c?a.preventDefault():g.m&&(a=a.changedTouches[0].pageX,50<=a-D?g.F.call(g):50<=D-a&&g.next.call(g));y=b});f.addEventListener("touchstart",function(a){D=a.changedTouches[0].pageX;
G.call(g)});f.addEventListener("touchend",function(a){a=a.changedTouches[0].pageX;50<=a-D?ba.call(g):50<=D-a&&ca.call(g)});window.addEventListener("popstate",function(){if(C(g.h))if(g.j.pop(),0<g.j.length){window.history.pushState({L:"boxplusx"},"");var a=w.call(g);g.j.pop();P.call(g,a)}else U.call(g)},!1);window.addEventListener("resize",function(){C(g.h)&&(Y.call(g),W.call(g),T.call(g))})};d.prototype.M=function(a,b){this.i=a;var c=this,d=1<a.length&&"hidden"!=this.a.navigation;k(this.u,d);d&&a.forEach(function(a,
b){var d=r("aspect"),e=r("navimage"),f=r("navitem",!1,[d,e]),k=!0;f.addEventListener("touchstart",function(){c.b.style.getPropertyValue("transition-duration")&&(k=!1)});f.addEventListener("click",function(){k&&c.o.call(c,b);k=!0});var h=a.image;h&&(a=function(){var a=d.style;a.setProperty("width",h.naturalWidth+"px");a.setProperty("padding-top",100*h.naturalHeight/h.naturalWidth+"%");e.style.setProperty("background-image",'url("'+h.src+'")')},h.src&&h.complete?a():(h.addEventListener("load",a),h.preloader&&
(a=h.preloader,a.load&&a.load())));e.innerText=b+1+"";c.b.appendChild(f)});this.N(b)};d.prototype.N=function(a){this.j=[];window.history.state&&"boxplusx"===window.history.state.L?window.history.replaceState(new q,""):window.history.pushState(new q,"");this.a.autostart&&0<this.a.slideshow&&(this.l=!0);k(this.h,!0);k(this.G,!0);this.o(a)};d.prototype.close=function(){J.call(this);U.call(this);this.j=[];window.history.go(-1)};d.prototype.o=function(a){a!=w.call(this)&&P.call(this,a)};d.prototype.I=
function(){this.o(0)};d.prototype.F=function(){var a=w.call(this);0<a?this.o(a-1):this.a.loop&&this.K()};d.prototype.next=function(){var a=w.call(this);a<this.i.length-1?this.o(a+1):this.a.loop&&this.I()};d.prototype.K=function(){this.o(this.i.length-1)};d.prototype.start=function(){0<this.a.slideshow&&(this.l=!0,X.call(this),N.call(this))};d.prototype.O=function(){0<this.a.slideshow&&(this.l=!1,J.call(this),N.call(this))};d.prototype.T=function(){var a=this.f.querySelector(".boxplusx-detail");a&&
k(a,!C(a))};d.prototype.download=function(){var a=document.createElement("a");a.href=this.i[w.call(this)].download;document.body.appendChild(a);a.click();document.body.removeChild(a)};d.discover=function(a,b,c){b=b||"boxplusx";var h=new d(c),f=function(a){var b={};[].forEach.call(a,function(a){var c=a.getAttribute("rel");Object.prototype.hasOwnProperty.call(b,c)||(b[c]=[]);b[c].push(a)});return b}(document.querySelectorAll("a[href][rel^="+b+"]:not([rel="+b+"])"));Object.keys(f).forEach(function(a){h.bind(f[a])});
[].filter.call(document.querySelectorAll("a[href][rel="+b+"]"),function(a){h.bind([a])});a||[].filter.call(document.querySelectorAll("a[href]:not([rel^="+b+"])"),function(a){return/\.(gif|jpe?g|png|svg|mov|mpe?g|ogg|webm)$/i.test(a.pathname)&&!a.target}).forEach(function(a){h.bind([a])})}})();}).call(this);
